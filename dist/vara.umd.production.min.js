!function(t){"function"==typeof define&&define.amd?define(t):t()}((function(){"use strict";function t(){return(t=Object.assign||function(t){for(var e=1;e<arguments.length;e++){var n=arguments[e];for(var i in n)Object.prototype.hasOwnProperty.call(n,i)&&(t[i]=n[i])}return t}).apply(this,arguments)}var e=function(){function e(t,e,n,i){this.elementName=t,this.element=document.querySelector(t),this.fontSource=e,this.options=i,this.textItems=n,this.renderData=n,this.rendered=!1,this.fontCharacters={},this.canvasWidth=0,this.defaultOptions={fontSize:21,strokeWidth:.5,color:"#000",duration:1e3,textAlign:"left",autoAnimation:!0,queued:!0,delay:0,breakWord:!1,letterSpacing:{global:0},width:this.element.getBoundingClientRect().width,lineHeight:30},this.defaultCharacters={63:{paths:[{w:8.643798828125,h:14.231731414794922,my:22.666500004827977,mx:0,dx:0,d:"m 0,0 c -2,-6.01,5,-8.64,8,-3.98,2,4.09,-7,8.57,-7,11.85",pl:1},{w:1.103759765625,h:1.549820899963379,my:8.881500004827977,dx:0,mx:1,d:"m 0,0 a 0.7592,0.7357,0,0,1,0,0.735,0.7592,0.7357,0,0,1,-1,-0.735,0.7592,0.7357,0,0,1,1,-0.738,0.7592,0.7357,0,0,1,0,0.738 z",pl:1}],w:8.643798828125}},this.canvas=document.createElement("canvas"),this.canvas.width=800,this.canvas.height=800,this.ctx=this.canvas.getContext("2d"),this.element.appendChild(this.canvas),this.WHITESPACE=10,this.SCALEBASE=16,this.contextHeight=0,this.init()}var n=e.prototype;return n.init=function(){var t=this;this.normalizeOptions();var e=new XMLHttpRequest;e.open("GET",this.fontSource,!0),e.onreadystatechange=function(){if(4==e.readyState&&200==e.status){var n=JSON.parse(e.responseText);t.fontCharacters=n.c,t.fontProperties=n.p,t.preRender(),t.render()}},e.send(null)},n.normalizeOptions=function(){var e=this;this.options=this.options||{},this.objectKeys(this.defaultOptions).forEach((function(t){void 0===e.options[t]&&(e.options[t]=e.defaultOptions[t])})),this.renderData.forEach((function(n,i){"string"==typeof n?e.renderData[i]=t({text:n},e.defaultOptions):"object"==typeof n&&e.objectKeys(e.options).forEach((function(t){void 0===n[t]&&(n[t]=e.options[t])}))})),Object.keys(this.defaultCharacters).forEach((function(t){void 0===e.fontCharacters[t]&&(e.fontCharacters[t]=e.defaultCharacters[t])}))},n.preRender=function(){var t=this,e=this.createSVGNode("svg",{width:"100",height:"100"});e.style.position="absolute",e.style.zIndex="-100",e.style.opacity="0",e.style.top="0",document.body.appendChild(e);var n=this.createSVGNode("path",{d:""});e.appendChild(n),this.objectKeys(this.fontCharacters).forEach((function(e){t.fontCharacters[e].paths.forEach((function(i,r){n.setAttributeNS(null,"d",i.d),t.fontCharacters[e].paths[r].dx=n.getBoundingClientRect().x,t.fontCharacters[e].paths[r].pl=n.getTotalLength()}))})),this.renderData.forEach((function(t){t.currentlyDrawing=0,t.startTime=!1})),this.generateRenderData(this.renderData[0])},n.render=function(t){var e=this;void 0===t&&(t=0);var n=this.calculateCanvasHeight();n!==this.canvas.height&&(this.canvas.height=n),this.ctx.clearRect(0,0,800,n),this.draw(this.renderData[0],t),window.requestAnimationFrame((function(t){return e.render(t)}))},n.draw=function(t,e){var n=this,i=t;this.ctx.strokeStyle=i.color,this.ctx.lineWidth=i.strokeWidth,this.ctx.fillStyle="transparent",this.ctx.lineCap="round",this.ctx.lineJoin="round";var r=i.fontSize/this.SCALEBASE,a=i.render.reduce((function(t,e){return t+e.pathLength}),0);i.startTime||(i.startTime=e),i.render.forEach((function(t,s){var h=(e-i.startTime)/1e3,o=t.pathLength/(t.pathLength/a*i.duration/1e3);n.ctx.save(),n.ctx.scale(r,r),n.ctx.lineDashOffset=1,n.ctx.setLineDash([t.dashOffset,t.pathLength+1]),i.currentlyDrawing===s&&(t.dashOffset>=t.pathLength&&(i.currentlyDrawing+=1),t.dashOffset+=o*h),n.ctx.stroke(new Path2D(n.processPath(t.path,t.x,t.y))),n.ctx.restore()})),i.startTime=e},n.generateRenderData=function(t){var e=this,n=t,i=n.fontSize/this.SCALEBASE;if(n.height=0,!n.breakWord){var r=("string"==typeof n.text?[n.text]:n.text).map((function(t){return t.split(" ")})),a=[{text:"",width:0}];r.forEach((function(t){var r=0;t.forEach((function(t){var s=0;t.split("").forEach((function(t){var n=t.charCodeAt(0),r=e.fontCharacters[n]||e.fontCharacters[63],a=r.paths.reduce((function(t,e){return t+e.mx-e.dx}),0);s+=(r.w+a)*i})),a[a.length-1].width+s+5*i+r+n.x*i>n.width?(a.push({text:t+" ",width:s}),r=0):(a[a.length-1]={text:a[a.length-1].text+t,width:a[a.length-1].width+s},r+=e.WHITESPACE*i,a[a.length-1].text+=" ")}))}));var s=n.x/i,h=this.getTopPosition(0)/i+n.y/i,o=n.lineHeight;n.render||(n.render=[]),a.forEach((function(t){var r=0,a=s,c=h;"center"===n.textAlign&&(a=(n.width-t.width)/2/i),t.text.split("").forEach((function(t){if(" "===t)r+=e.WHITESPACE;else{var i=e.fontCharacters[t.charCodeAt(0)]||e.fontCharacters[63];i.paths.forEach((function(t){n.render.push({path:t.d,x:a+r+t.mx-t.dx,y:c+o-t.my,pathLength:t.pl,dashOffset:0})})),r+=i.w}})),o+=n.lineHeight,n.absolutePosition||(console.log(n.height,n.lineHeight),n.height+=n.lineHeight*i)}))}},n.calculateCanvasHeight=function(){var t=0;return this.renderData.forEach((function(e){e.height&&e.y&&(t+=e.height+e.y)})),t+50},n.getTopPosition=function(t){return 0===t?0:1},n.alterText=function(t,e,n){var i;this.renderData[t].currentlyDrawing=0,this.renderData[t].render=[],this.renderData[t].text=e;var r=n(e);this.generateRenderData(this.renderData[t]),null===(i=this.renderData[t].render)||void 0===i||i.forEach((function(t,e){r.includes(e)||(t.dashOffset=t.pathLength)}))},n.createSVGNode=function(t,e){var n=document.createElementNS("http://www.w3.org/2000/svg",t);for(var i in e)n.setAttributeNS(null,i.replace(/[A-Z]/g,(function(t){return"-"+t.toLowerCase()})),e[i]);return n},n.processPath=function(t,e,n){void 0===e&&(e=0),void 0===n&&(n=0);var i=t.split("");return i[2]=e+1+"",i[4]=n+"",i.join("")},n.objectKeys=function(t){return Object.keys(t)},n.boundRect=function(t,e,n,i){void 0===i&&(i=10),this.ctx.save(),this.ctx.fillStyle="rgba(209, 56, 61,0.4)",this.ctx.fillRect(t,e,n,i),this.ctx.fill(),this.ctx.restore()},e}();window&&(window.Vara=e)}));
//# sourceMappingURL=vara.umd.production.min.js.map
