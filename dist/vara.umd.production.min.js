!function(t){"function"==typeof define&&define.amd?define(t):t()}((function(){"use strict";function t(){return(t=Object.assign||function(t){for(var e=1;e<arguments.length;e++){var n=arguments[e];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(t[r]=n[r])}return t}).apply(this,arguments)}var e=function(){function e(t,e,n,r){this.elementName=t,this.element=document.querySelector(t),this.fontSource=e,this.options=r,this.textItems=n,this.renderData=n,this.rendered=!1,this.fontCharacters={},this.canvasWidth=0,this.defaultOptions={fontSize:21,strokeWidth:.5,color:"#000",duration:1e3,textAlign:"left",autoAnimation:!0,queued:!0,delay:0,breakWord:!1,letterSpacing:{global:0},width:this.element.getBoundingClientRect().width},this.defaultCharacters={63:{paths:[{w:8.643798828125,h:14.231731414794922,my:22.666500004827977,mx:0,dx:0,d:"m 0,0 c -2,-6.01,5,-8.64,8,-3.98,2,4.09,-7,8.57,-7,11.85",pl:1},{w:1.103759765625,h:1.549820899963379,my:8.881500004827977,dx:0,mx:1,d:"m 0,0 a 0.7592,0.7357,0,0,1,0,0.735,0.7592,0.7357,0,0,1,-1,-0.735,0.7592,0.7357,0,0,1,1,-0.738,0.7592,0.7357,0,0,1,0,0.738 z",pl:1}],w:8.643798828125}},this.canvas=document.createElement("canvas"),this.canvas.width=800,this.canvas.height=800,this.ctx=this.canvas.getContext("2d"),this.element.appendChild(this.canvas),this.WHITESPACE=10,this.SCALEBASE=16,this.init()}var n=e.prototype;return n.init=function(){var t=this;this.normalizeOptions();var e=new XMLHttpRequest;e.open("GET",this.fontSource,!0),e.onreadystatechange=function(){if(4==e.readyState&&200==e.status){var n=JSON.parse(e.responseText);t.fontCharacters=n.c,t.fontProperties=n.p,t.preRender(),t.render()}},e.send(null)},n.preRender=function(){var t=this,e=this.createSVGNode("svg",{width:"100",height:"100"});e.style.position="absolute",e.style.zIndex="-100",e.style.opacity="0",e.style.top="0",document.body.appendChild(e);var n=this.createSVGNode("path",{d:""});e.appendChild(n),this.objectKeys(this.fontCharacters).forEach((function(e){t.fontCharacters[e].paths.forEach((function(r,i){n.setAttributeNS(null,"d",r.d),t.fontCharacters[e].paths[i].dx=n.getBoundingClientRect().x,t.fontCharacters[e].paths[i].pl=n.getTotalLength()}))})),this.renderData.forEach((function(t){t.currentlyDrawing=0,t.startTime=!1})),this.generateRenderData(this.renderData[1])},n.render=function(t){var e=this;void 0===t&&(t=0),this.ctx.clearRect(0,0,800,800),this.draw(this.renderData[1],t),window.requestAnimationFrame((function(t){return e.render(t)}))},n.draw=function(t,e){var n=this,r=t;this.ctx.strokeStyle=r.color,this.ctx.lineWidth=r.strokeWidth,this.ctx.fillStyle="transparent",this.ctx.lineCap="round",this.ctx.lineJoin="round";var i=r.fontSize/this.SCALEBASE,a=r.render.reduce((function(t,e){return t+e.pathLength}),0);r.startTime||(r.startTime=e),r.render.forEach((function(t,o){var s=(e-r.startTime)/1e3,h=t.pathLength/(t.pathLength/a*r.duration/1e3);n.ctx.save(),n.ctx.scale(i,i),n.ctx.setLineDash([t.dashOffset,t.pathLength]),r.currentlyDrawing===o&&(console.log(r.currentlyDrawing,h,s),t.dashOffset>=t.pathLength&&(r.currentlyDrawing+=1),t.dashOffset+=h*s),n.ctx.stroke(new Path2D(n.processPath(t.path,t.x,t.y))),n.ctx.restore()})),r.startTime=e},n.normalizeOptions=function(){var e=this;this.options=this.options||{},this.objectKeys(this.defaultOptions).forEach((function(t){void 0===e.options[t]&&(e.options[t]=e.defaultOptions[t])})),this.renderData.forEach((function(n,r){"string"==typeof n?e.renderData[r]=t({text:n},e.defaultOptions):"object"==typeof n&&e.objectKeys(e.options).forEach((function(t){void 0===n[t]&&(n[t]=e.options[t])}))})),Object.keys(this.defaultCharacters).forEach((function(t){void 0===e.fontCharacters[t]&&(e.fontCharacters[t]=e.defaultCharacters[t])}))},n.generateRenderData=function(t){var e=this,n=t,r=n.fontSize/this.SCALEBASE;if(!n.breakWord){var i=("string"==typeof n.text?[n.text]:n.text).map((function(t){return t.split(" ")})),a=[{text:"",width:0}];i.forEach((function(t){var i=0;t.forEach((function(t){var o=0;t.split("").forEach((function(t){var n=t.charCodeAt(0),i=e.fontCharacters[n]||e.fontCharacters[63],a=i.paths.reduce((function(t,e){return t+e.mx-e.dx}),0);o+=(i.w+a)*r})),a[a.length-1].width+o+5*r+i+n.x*r>n.width?(a.push({text:t+" ",width:o}),i=0):(a[a.length-1]={text:a[a.length-1].text+t,width:a[a.length-1].width+o},i+=e.WHITESPACE*r,a[a.length-1].text+=" ")}))}));var o=n.x/r,s=n.y/r,h=1.2*n.fontSize;a.forEach((function(t){var i=0,a=o,c=s;console.log(n.width,t.width,n.width-t.width),"center"===n.textAlign&&(a=(n.width-t.width)/2/r),t.text.split("").forEach((function(t){if(" "===t)i+=e.WHITESPACE;else{var r=e.fontCharacters[t.charCodeAt(0)]||e.fontCharacters[63];n.render||(n.render=[]),r.paths.forEach((function(t){n.render.push({path:t.d,x:a+i+t.mx-t.dx,y:c+h-t.my,pathLength:t.pl,dashOffset:0})})),i+=r.w}})),h+=30}))}},n.createSVGNode=function(t,e){var n=document.createElementNS("http://www.w3.org/2000/svg",t);for(var r in e)n.setAttributeNS(null,r.replace(/[A-Z]/g,(function(t){return"-"+t.toLowerCase()})),e[r]);return n},n.processPath=function(t,e,n){void 0===e&&(e=0),void 0===n&&(n=0);var r=t.split("");return r[2]=e+1+"",r[4]=n+"",r.join("")},n.objectKeys=function(t){return Object.keys(t)},n.boundRect=function(t,e,n,r){void 0===r&&(r=10),this.ctx.save(),this.ctx.fillStyle="rgba(209, 56, 61,0.4)",this.ctx.fillRect(t,e,n,r),this.ctx.fill(),this.ctx.restore()},e}();window&&(window.Vara=e)}));
//# sourceMappingURL=vara.umd.production.min.js.map
