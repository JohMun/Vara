!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?e(exports):"function"==typeof define&&define.amd?define(["exports"],e):e((t=t||self).vara={})}(this,(function(t){"use strict";function e(){return(e=Object.assign||function(t){for(var e=1;e<arguments.length;e++){var i=arguments[e];for(var n in i)Object.prototype.hasOwnProperty.call(i,n)&&(t[n]=i[n])}return t}).apply(this,arguments)}function i(t,e){t.prototype=Object.create(e.prototype),t.prototype.constructor=t,t.__proto__=e}function n(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}var s=["block","line","letter","letterPart"],r=function(){function t(t){var e;this.ctx=t.ctx,this.parent=null!==(e=t.parent)&&void 0!==e?e:null,this.name="block"}return t.prototype.getParent=function(t,e){return s.indexOf(t)<s.indexOf(this.name)&&(e.name===t?e:!!e.parent&&this.getParent(t,null==e?void 0:e.parent))},t}(),h=function(t){function e(e){var i;return(i=t.call(this,e)||this).x=e.x,i.y=e.y,i.path=e.path,i.pathLength=e.pathLength,i.dashOffset=e.dashOffset,i.width=e.width,i.name="letterPart",i.rootBlock=i.getParent("block",n(i)),i}i(e,t);var s=e.prototype;return s.paint=function(){this.ctx.save(),this.ctx.stroke(new Path2D(this.processPath(this.path,this.x,this.y))),this.ctx.restore()},s.draw=function(t){var e=this.pathLength/(this.pathLength/this.rootBlock.totalPathLength*this.rootBlock.options.duration/1e3);this.ctx.save(),this.ctx.lineDashOffset=1,this.ctx.setLineDash([this.dashOffset,this.pathLength+1]),this.dashOffset+=e*t,this.paint(),this.ctx.restore()},s.processPath=function(t,e,i){void 0===e&&(e=0),void 0===i&&(i=0);var n=t.split("");return n[2]=e+"",n[4]=i+"",n.join("")},e}(r),a=function(t){function s(e){var i;return(i=t.call(this,e)||this).x=e.x,i.y=e.y,i.width=e.width,i.parts=[],i.drawnParts=[],i.name="letter",i.rootBlock=i.getParent("block",n(i)),i}i(s,t);var r=s.prototype;return r.setPosition=function(t,e){this.x=t,this.y=e},r.addPart=function(t){this.parts.push(new h(e({},t,{ctx:this.ctx,parent:this}))),this.rootBlock&&this.rootBlock.modifyPathLength(t.pathLength,"increment")},r.dequeue=function(){var t=this.parts.shift();t&&this.drawnParts.push(t)},r.render=function(t,e){this.ctx.save(),this.ctx.scale(this.rootBlock.scale,this.rootBlock.scale),this.ctx.translate(this.x,this.y);var i=(t-e)/1e3;if(this.parts.length>0){var n=this.parts[0];n.dashOffset>n.pathLength?this.dequeue():n.draw(i)}this.drawnParts.forEach((function(t){t.paint()})),this.ctx.restore()},r.paint=function(){this.ctx.save(),this.ctx.scale(this.rootBlock.scale,this.rootBlock.scale),this.ctx.translate(this.x,this.y),this.drawnParts.forEach((function(t){t.paint()})),this.ctx.restore()},s}(r),o=function(t){function n(e){var i;return(i=t.call(this,e)||this).x=e.x,i.y=e.y,i.ctx=e.ctx,i.letters=[],i.drawnLetters=[],i.name="line",i}i(n,t);var s=n.prototype;return s.addLetter=function(t){console.log("adding letter",this.name);var i=new a(e({},t,{parent:this,ctx:this.ctx}));return this.letters.push(i),i},s.dequeue=function(){var t=this.letters.shift();t&&this.drawnLetters.push(t)},s.render=function(t,e){if(this.ctx.save(),this.ctx.translate(this.x,this.y),this.letters.length>0){var i=this.letters[0];i.render(t,e),0===i.parts.length&&this.dequeue()}this.drawnLetters.forEach((function(t){t.paint()})),this.ctx.restore()},s.paint=function(){this.ctx.save(),this.ctx.translate(this.x,this.y),this.drawnLetters.forEach((function(t){t.paint()})),this.ctx.restore()},n}(r),c=function(t){function n(e){var i;return(i=t.call(this,e)||this).x=e.x,i.y=e.y,i.width=e.width,i.lines=[],i.drawnLines=[],i.ctx=e.ctx,i.previousRAFTime=0,i.totalPathLength=0,i.options=e.options,i.name="block",i.scale=e.options.fontSize/16,i}i(n,t);var s=n.prototype;return s.addLine=function(t){var i=new o(e({},t,{ctx:this.ctx,parent:this}));return this.lines.push(i),i},s.dequeue=function(){var t=this.lines.shift();t&&this.lines.push(t)},s.modifyPathLength=function(t,e){return void 0===e&&(e="increment"),"increment"===e?this.totalPathLength+=t:this.totalPathLength-=t,this.totalPathLength},s.render=function(t){if(0===this.previousRAFTime&&(this.previousRAFTime=t),this.ctx.save(),this.ctx.strokeStyle=this.options.color,this.ctx.lineWidth=this.options.strokeWidth,this.ctx.lineCap="round",this.ctx.lineJoin="round",this.drawnLines.forEach((function(t){t.paint()})),this.lines.length>0){var e=this.lines[0];e.render(t,this.previousRAFTime),0===e.letters.length&&this.dequeue()}this.ctx.restore(),this.previousRAFTime=t},n}(r),u=function(){function t(t){this.textItem=e({},t.options,t.textItem),console.log(this.textItem),this.height=0,this.fontCharacters=t.fontCharacters,this.ctx=t.ctx,this.block=null}var i=t.prototype;return i.generatePositions=function(){var t=this,e=this.textItem.fontSize/16;if(this.height=0,!this.textItem.breakWord){var i=("string"==typeof this.textItem.text?[this.textItem.text]:this.textItem.text).map((function(t){return t.split(" ")})),n=[{text:"",width:0}];i.forEach((function(i){var s=0;i.forEach((function(i){var r=0;i.split("").forEach((function(i){var n=i.charCodeAt(0),s=t.fontCharacters[n]||t.fontCharacters[63],h=s.paths.reduce((function(t,e){return t+e.mx-e.dx}),0);r+=(s.w+h)*e})),n[n.length-1].width+r+5*e+s+t.textItem.x*e>t.textItem.width?(n.push({text:i+" ",width:r}),s=0):(n[n.length-1]={text:n[n.length-1].text+i,width:n[n.length-1].width+r},s+=10*e,n[n.length-1].text+=" ")}))}));var s=this.textItem.lineHeight,r=new c({width:this.textItem.width,x:this.textItem.x,y:this.textItem.y,ctx:this.ctx,options:this.textItem});n.forEach((function(i){var n=0,h=0;"center"===t.textItem.textAlign&&(h=(t.textItem.width-i.width)/2);var a=r.addLine({x:h,y:0});i.text.split("").forEach((function(e){if(console.log(e)," "===e)n+=10;else{var i=t.fontCharacters[e.charCodeAt(0)]||t.fontCharacters[63],r=a.addLetter({x:n,y:s,width:i.w});i.paths.forEach((function(t){r.addPart({path:t.d,x:t.mx-t.dx,y:-t.my,pathLength:t.pl,dashOffset:0,width:t.w})})),n+=i.w}})),s+=t.textItem.lineHeight,t.height+=t.textItem.lineHeight*e})),this.block=r}},i.render=function(t){this.block&&this.block.render(t)},i.rendered=function(){var t;return 0===(null===(t=this.block)||void 0===t?void 0:t.lines.length)},t}(),d=function(){function t(t,e,i,n){this.elementName=t,this.element=document.querySelector(t),this.fontSource=e,this.options=n,this.textItems=i,this.renderData={nonQueued:[],queued:[]},this.rendered=!1,this.fontCharacters={},this.canvasWidth=0,this.defaultOptions={fontSize:21,strokeWidth:.5,color:"#000",duration:1e3,textAlign:"left",autoAnimation:!0,queued:!0,delay:0,breakWord:!1,letterSpacing:{global:0},width:this.element.getBoundingClientRect().width,lineHeight:30},this.defaultCharacters={63:{paths:[{w:8.6437,h:14.23173,my:22.6665,mx:0,dx:0,d:"m 0,0 c -2,-6.01,5,-8.64,8,-3.98,2,4.09,-7,8.57,-7,11.85",pl:1},{w:1.1037,h:1.5498,my:8.8815,dx:0,mx:1,d:"m 0,0 a 0.7592,0.7357,0,0,1,0,0.735,0.7592,0.7357,0,0,1,-1,-0.735,0.7592,0.7357,0,0,1,1,-0.738,0.7592,0.7357,0,0,1,0,0.738 z",pl:1}],w:8.6437}},this.canvas=document.createElement("canvas"),this.canvas.width=800,this.canvas.height=800,this.ctx=this.canvas.getContext("2d"),this.element.appendChild(this.canvas),this.WHITESPACE=10,this.SCALEBASE=16,this.contextHeight=0,this.init()}var i=t.prototype;return i.init=function(){var t=this;this.normalizeOptions();var e=new XMLHttpRequest;e.open("GET",this.fontSource,!0),e.onreadystatechange=function(){if(4==e.readyState&&200==e.status){var i=JSON.parse(e.responseText);t.fontCharacters=i.c,t.fontProperties=i.p,t.preRender(),t.render()}},e.send(null)},i.onDraw=function(t){this.onDrawF=t},i.normalizeOptions=function(){var t=this;this.options=this.options||{},this.options=e({},this.defaultOptions,this.options),Object.keys(this.defaultCharacters).forEach((function(e){void 0===t.fontCharacters[e]&&(t.fontCharacters[e]=t.defaultCharacters[e])}))},i.preRender=function(){var t=this,e=this.createSVGNode("svg",{width:"100",height:"100"});e.style.position="absolute",e.style.zIndex="-100",e.style.opacity="0",e.style.top="0",document.body.appendChild(e);var i=this.createSVGNode("path",{d:""});e.appendChild(i),this.objectKeys(this.fontCharacters).forEach((function(e){t.fontCharacters[e].paths.forEach((function(n,s){i.setAttributeNS(null,"d",n.d),t.fontCharacters[e].paths[s].dx=i.getBoundingClientRect().x,t.fontCharacters[e].paths[s].pl=i.getTotalLength()}))})),this.textItems.forEach((function(e){var i=new u({fontCharacters:t.fontCharacters,options:t.options,textItem:e,ctx:t.ctx});i.generatePositions(),e.queued?t.renderData.queued.push(i):t.renderData.nonQueued.push(i)}))},i.render=function(t){var e=this;void 0===t&&(t=0);var i=this.calculateCanvasHeight();if(i!==this.canvas.height&&(this.canvas.height=i),this.ctx.clearRect(0,0,this.canvas.width,i),this.renderData.nonQueued.forEach((function(e){e.render(t)})),this.renderData.queued.length>0){var n=this.renderData.queued[0];n.render(t),n.rendered()&&this.dequeue()}window.requestAnimationFrame((function(t){return e.render(t)}))},i.dequeue=function(){var t=this.renderData.queued.shift();t&&this.renderData.nonQueued.push(t)},i.calculateCanvasHeight=function(){var t=0;return[].concat(this.renderData.nonQueued,this.renderData.queued).forEach((function(e){e.height&&e.textItem.y&&(t+=e.height+e.textItem.y)})),t+50},i.createSVGNode=function(t,e){var i=document.createElementNS("http://www.w3.org/2000/svg",t);for(var n in e)i.setAttributeNS(null,n.replace(/[A-Z]/g,(function(t){return"-"+t.toLowerCase()})),e[n]);return i},i.processPath=function(t,e,i){void 0===e&&(e=0),void 0===i&&(i=0);var n=t.split("");return n[2]=e+1+"",n[4]=i+"",n.join("")},i.objectKeys=function(t){return Object.keys(t)},i.boundRect=function(t,e,i,n){void 0===n&&(n=10),this.ctx.save(),this.ctx.fillStyle="rgba(209, 56, 61,0.4)",this.ctx.fillRect(t,e,i,n),this.ctx.fill(),this.ctx.restore()},t}();window&&(window.Vara=d),t.default=d,Object.defineProperty(t,"__esModule",{value:!0})}));
//# sourceMappingURL=vara.umd.production.min.js.map
